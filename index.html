<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alat Penerjemah Novel - Terjemahan Alami</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #5d5fef;
            --secondary-color: #6b98d1;
            --accent-color: #ff6b6b;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --border-radius: 10px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 25px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary-color), #7476ed);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 60%);
            transform: rotate(30deg);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .description {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            opacity: 0.9;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 25px;
            margin-bottom: 25px;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
            display: flex;
            align-items: center;
        }
        
        label i {
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        select, button {
            padding: 12px 15px;
            border-radius: var(--border-radius);
            border: 1px solid #ced4da;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        select {
            background-color: #f8f9fa;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%235d5fef' viewBox='0 0 16 16'%3E%3Cpath d='M8 12L2 6h12L8 12z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            padding-right: 40px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 95, 239, 0.25);
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: #4a4cdf;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background-color: #adb5bd;
            cursor: not-allowed;
            transform: none;
        }
        
        .text-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 900px) {
            .text-grid {
                grid-template-columns: 1fr;
            }
        }
        
        textarea {
            width: 100%;
            min-height: 350px;
            padding: 20px;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            resize: vertical;
            font-size: 1.05rem;
            line-height: 1.6;
            transition: var(--transition);
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 95, 239, 0.25);
        }
        
        #source-text {
            background-color: #f8f9fa;
        }
        
        #translated-text {
            background-color: #f0f9ff;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 18px;
            border-radius: var(--border-radius);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-accent:hover {
            background-color: #e55c5c;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .btn-warning:hover {
            background-color: #e0a800;
        }
        
        .progress-container {
            margin-top: 20px;
            display: none;
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        progress {
            width: 100%;
            height: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        progress::-webkit-progress-bar {
            background-color: #e9ecef;
            border-radius: 10px;
        }
        
        progress::-webkit-progress-value {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
        }
        
        .status {
            text-align: center;
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .char-count {
            font-size: 0.9rem;
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .char-count.warning {
            color: var(--warning-color);
            font-weight: 500;
        }
        
        .char-count.error {
            color: #dc3545;
            font-weight: 500;
        }
        
        footer {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            color: #6c757d;
            font-size: 1rem;
        }
        
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            padding: 18px 25px;
            background-color: var(--success-color);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transform: translateX(100%);
            transition: transform 0.4s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background-color: #dc3545;
        }
        
        .notification.warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }
        
        .language-swap {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
        }
        
        .swap-btn {
            width: auto;
            padding: 8px 16px;
            font-size: 0.95rem;
            background-color: #6c757d;
        }
        
        .swap-btn:hover {
            background-color: #5a6268;
        }
        
        .settings-panel {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-top: 25px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .settings-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            width: 100%;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .checkbox-group:hover {
            background-color: #e9ecef;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
            cursor: pointer;
        }

        .checkbox-group label {
            margin-bottom: 0;
            cursor: pointer;
            font-weight: 500;
            color: var(--dark-color);
        }

        .tooltip {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: help;
        }

        .tooltip-icon {
            color: #6c757d;
            font-size: 0.9rem;
            margin-left: 5px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
            line-height: 1.4;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--dark-color) transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            background-color: #f8f9fa;
            padding: 5px;
            border-radius: 30px;
            width: fit-content;
        }

        .mode-btn {
            padding: 8px 20px;
            background-color: transparent;
            color: #6c757d;
            border-radius: 20px;
            font-size: 0.95rem;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .mode-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .advanced-settings {
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #dee2e6;
        }

        .advanced-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
            width: fit-content;
        }

        .advanced-content {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }

        .advanced-content.show {
            display: block;
        }

        .slider-group {
            margin-bottom: 15px;
        }

        .slider-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
        }

        input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: #dee2e6;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        input[type="range"]::-moz-range-thumb:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 5px 12px;
            background-color: #e9ecef;
            border: none;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .preset-btn:hover {
            background-color: #dee2e6;
        }

        .preset-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .history-panel {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-top: 25px;
            display: none;
        }

        .history-panel.show {
            display: block;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .history-item:hover {
            background-color: #f8f9fa;
        }

        .history-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-right: 15px;
        }

        .history-actions {
            display: flex;
            gap: 8px;
        }

        .history-btn {
            padding: 5px 10px;
            background-color: #e9ecef;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .history-btn:hover {
            background-color: #dee2e6;
        }

        .history-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .history-btn.primary:hover {
            background-color: var(--secondary-color);
        }

        .save-session {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .session-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .save-btn {
            padding: 10px 20px;
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .save-btn:hover {
            background-color: #218838;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .settings-panel {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .checkbox-group {
                width: 100%;
            }
            
            .advanced-content {
                padding: 10px;
            }
            
            .slider-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            input[type="range"] {
                width: 100%;
            }
            
            .preset-buttons {
                flex-wrap: wrap;
            }
            
            .save-session {
                flex-direction: column;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .settings-panel {
                background-color: #2d3748;
                color: #e2e8f0;
            }
            
            .checkbox-group {
                background-color: #4a5568;
            }
            
            .checkbox-group:hover {
                background-color: #2d3748;
            }
            
            .checkbox-group label {
                color: #e2e8f0;
            }
            
            .tooltip-icon {
                color: #cbd5e0;
            }
            
            .mode-selector {
                background-color: #4a5568;
            }
            
            .advanced-content {
                background-color: #4a5568;
            }
            
            input[type="range"] {
                background: #4a5568;
            }
        }
        
        .api-info {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            font-size: 0.9rem;
        }
        
        .api-info h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Alat Penerjemah Novel</h1>
            <p class="description">Terjemahkan novel dengan hasil alami seperti manusia, dengan penanganan huruf besar/kecil dan kapitalisasi yang tepat</p>
        </header>
        
        <div class="controls-grid">
            <div class="control-group">
                <label for="source-lang"><i class="fas fa-language"></i> Bahasa Sumber</label>
                <select id="source-lang">
                    <option value="auto">Deteksi Otomatis</option>
                    <option value="en">English</option>
                    <option value="ja">Japanese</option>
                    <option value="ko">Korean</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                    <option value="zh-TW">Chinese (Traditional)</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="ru">Russian</option>
                    <option value="ar">Arabic</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="target-lang"><i class="fas fa-globe"></i> Bahasa Target</label>
                <select id="target-lang">
                    <option value="id">Indonesian</option>
                    <option value="en">English</option>
                    <option value="ms">Malaysian</option>
                    <option value="ja">Japanese</option>
                    <option value="ko">Korean</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                    <option value="zh-TW">Chinese (Traditional)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="translate-btn"><i class="fas fa-exchange-alt"></i> Aksi</label>
                <button id="translate-btn">
                    <i class="fas fa-language"></i> Terjemahkan
                </button>
                <div class="language-swap">
                    <button id="swap-langs" class="swap-btn">
                        <i class="fas fa-exchange-alt"></i> Tukar Bahasa
                    </button>
                </div>
            </div>
        </div>
        
        <div class="mode-selector">
            <div class="mode-btn active" id="mode-novel">Mode Novel</div>
            <div class="mode-btn" id="mode-formal">Mode Formal</div>
        </div>
        
        <div class="text-grid">
            <div class="card">
                <div class="card-title">
                    <span>Teks Asli</span>
                    <div class="char-count">
                        <i class="fas fa-font"></i>
                        <span id="source-char-count">0</span> karakter
                    </div>
                </div>
                <textarea id="source-text" placeholder="Masukkan teks novel yang ingin diterjemahkan di sini..."></textarea>
                <div class="action-buttons">
                    <button id="clear-source" class="btn btn-secondary">
                        <i class="fas fa-broom"></i> Bersihkan
                    </button>
                    <button id="import-file" class="btn btn-success">
                        <i class="fas fa-file-import"></i> Impor dari File
                    </button>
                    <input type="file" id="file-input" accept=".txt" style="display: none;">
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <span>Hasil Terjemahan</span>
                    <div class="char-count">
                        <i class="fas fa-font"></i>
                        <span id="target-char-count">0</span> karakter
                    </div>
                </div>
                <textarea id="translated-text" readonly placeholder="Hasil terjemahan akan muncul di sini..."></textarea>
                <div class="action-buttons">
                    <button id="clear-target" class="btn btn-secondary">
                        <i class="fas fa-broom"></i> Bersihkan
                    </button>
                    <button id="export-file" class="btn btn-success">
                        <i class="fas fa-file-export"></i> Ekspor ke File
                    </button>
                    <button id="copy-text" class="btn btn-accent">
                        <i class="fas fa-copy"></i> Salin Teks
                    </button>
                </div>
            </div>
        </div>
        
        <div class="settings-panel">
            <div class="settings-title">
                <i class="fas fa-cog"></i> Pengaturan Terjemahan
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="capitalize-after-dot" checked>
                <label for="capitalize-after-dot">Kapitalisasi setelah tanda titik</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="fix-capitalization" checked>
                <label for="fix-capitalization">Perbaiki kapitalisasi</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="natural-translation" checked>
                <label for="natural-translation">Terjemahan alami</label>
                <div class="tooltip">
                    <i class="fas fa-question-circle tooltip-icon"></i>
                    <span class="tooltiptext">Menggunakan terjemahan yang lebih alami seperti percakapan manusia</span>
                </div>
            </div>
            
            <div class="advanced-settings">
                <div class="advanced-toggle" id="advanced-toggle">
                    <i class="fas fa-chevron-down"></i>
                    <span>Pengaturan Lanjutan</span>
                </div>
                
                <div class="advanced-content" id="advanced-content">
                    <div class="slider-group">
                        <label for="formality-slider">Tingkat Formalitas</label>
                        <div class="slider-container">
                            <input type="range" id="formality-slider" min="0" max="100" value="50">
                            <span class="slider-value" id="formality-value">50%</span>
                        </div>
                        <div class="preset-buttons">
                            <button class="preset-btn" id="preset-casual">Kasual</button>
                            <button class="preset-btn active" id="preset-standard">Standar</button>
                            <button class="preset-btn" id="preset-formal">Formal</button>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="preserve-formatting" checked>
                        <label for="preserve-formatting">Pertahankan pemformatan</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="translate-placeholders">
                        <label for="translate-placeholders">Terjemahkan placeholder</label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="history-panel" id="history-panel">
            <div class="history-header">
                <div class="history-title">
                    <i class="fas fa-history"></i> Riwayat Terjemahan
                </div>
                <button id="clear-history" class="btn btn-warning">
                    <i class="fas fa-trash"></i> Hapus Riwayat
                </button>
            </div>
            
            <div class="history-list" id="history-list">
                <!-- Riwayat terjemahan akan dimuat di sini -->
            </div>
            
            <div class="save-session">
                <input type="text" class="session-input" id="session-name" placeholder="Nama sesi terjemahan">
                <button class="save-btn" id="save-session">
                    <i class="fas fa-save"></i> Simpan Sesi
                </button>
            </div>
        </div>
        
        <div class="progress-container" id="progress-container">
            <progress id="translation-progress" value="0" max="100"></progress>
            <div class="status" id="progress-status">Memproses...</div>
        </div>
        
        <div class="api-info">
            <h3><i class="fas fa-info-circle"></i> Informasi API Terjemahan</h3>
            <p>Alat ini menggunakan Google Translate API untuk terjemahan. Jika terjemahan tidak bekerja, mungkin karena:</p>
            <ul>
                <li>Koneksi internet terputus</li>
                <li>Google Translate API tidak dapat diakses</li>
                <li>Pemblokiran oleh browser atau ekstensi</li>
            </ul>
            <p>Pastikan Anda terhubung ke internet dan mencoba lagi.</p>
        </div>
        
        <footer>
            <p>Alat Penerjemah Novel &copy; 2023 | Hasil terjemahan lebih alami seperti manusia</p>
            <p>Dengan penanganan huruf besar/kecil dan kapitalisasi otomatis</p>
        </footer>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span>Operasi berhasil!</span>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const sourceText = document.getElementById('source-text');
            const translatedText = document.getElementById('translated-text');
            const sourceLang = document.getElementById('source-lang');
            const targetLang = document.getElementById('target-lang');
            const translateBtn = document.getElementById('translate-btn');
            const clearSourceBtn = document.getElementById('clear-source');
            const clearTargetBtn = document.getElementById('clear-target');
            const importFileBtn = document.getElementById('import-file');
            const exportFileBtn = document.getElementById('export-file');
            const copyTextBtn = document.getElementById('copy-text');
            const fileInput = document.getElementById('file-input');
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('translation-progress');
            const progressStatus = document.getElementById('progress-status');
            const notification = document.getElementById('notification');
            const swapLangsBtn = document.getElementById('swap-langs');
            const sourceCharCount = document.getElementById('source-char-count');
            const targetCharCount = document.getElementById('target-char-count');
            const capitalizeAfterDot = document.getElementById('capitalize-after-dot');
            const fixCapitalization = document.getElementById('fix-capitalization');
            const naturalTranslation = document.getElementById('natural-translation');
            const modeNovel = document.getElementById('mode-novel');
            const modeFormal = document.getElementById('mode-formal');
            const advancedToggle = document.getElementById('advanced-toggle');
            const advancedContent = document.getElementById('advanced-content');
            const formalitySlider = document.getElementById('formality-slider');
            const formalityValue = document.getElementById('formality-value');
            const historyPanel = document.getElementById('history-panel');
            const historyList = document.getElementById('history-list');
            const clearHistoryBtn = document.getElementById('clear-history');
            const sessionNameInput = document.getElementById('session-name');
            const saveSessionBtn = document.getElementById('save-session');
            const preserveFormatting = document.getElementById('preserve-formatting');
            const translatePlaceholders = document.getElementById('translate-placeholders');
            const presetCasual = document.getElementById('preset-casual');
            const presetStandard = document.getElementById('preset-standard');
            const presetFormal = document.getElementById('preset-formal');
            
            // Supported languages
            const languages = {
                'auto': 'Deteksi Otomatis',
                'id': 'Indonesian',
                'en': 'English',
                'ms': 'Malaysian',
                'ja': 'Japanese',
                'ko': 'Korean',
                'zh-CN': 'Chinese (Simplified)',
                'zh-TW': 'Chinese (Traditional)',
                'es': 'Spanish',
                'fr': 'French',
                'de': 'German',
                'ru': 'Russian',
                'ar': 'Arabic',
                'pt': 'Portuguese',
                'it': 'Italian',
                'nl': 'Dutch',
                'th': 'Thai',
                'vi': 'Vietnamese',
                'hi': 'Hindi'
            };
            
            // Mode terjemahan
            let translationMode = 'novel';
            
            // Populate language dropdowns
            function populateLanguageDropdowns() {
                for (const [code, name] of Object.entries(languages)) {
                    // Source lang
                    const sourceOption = document.createElement('option');
                    sourceOption.value = code;
                    sourceOption.textContent = name;
                    if (code === 'auto') {
                        sourceOption.selected = true;
                    }
                    sourceLang.appendChild(sourceOption);
                    
                    // Target lang (skip 'auto')
                    if (code !== 'auto') {
                        const targetOption = document.createElement('option');
                        targetOption.value = code;
                        targetOption.textContent = name;
                        if (code === 'id') {
                            targetOption.selected = true;
                        }
                        targetLang.appendChild(targetOption);
                    }
                }
            }
            
            // Show notification
            function showNotification(message, type = 'success') {
                notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i><span>${message}</span>`;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // Update character count
            function updateCharCount() {
                const sourceCount = sourceText.value.length;
                const targetCount = translatedText.value.length;
                
                sourceCharCount.textContent = sourceCount.toLocaleString();
                targetCharCount.textContent = targetCount.toLocaleString();
                
                // Warning for long text
                if (sourceCount > 5000) {
                    sourceCharCount.parentElement.classList.add('warning');
                } else {
                    sourceCharCount.parentElement.classList.remove('warning');
                }
            }
            
            // Swap languages
            swapLangsBtn.addEventListener('click', function() {
                const sourceValue = sourceLang.value;
                const targetValue = targetLang.value;
                
                // Don't swap if source is auto
                if (sourceValue === 'auto') {
                    showNotification('Tidak dapat menukar bahasa ketika bahasa sumber "Deteksi Otomatis"', 'error');
                    return;
                }
                
                sourceLang.value = targetValue;
                targetLang.value = sourceValue;
                
                // Also swap text content
                const sourceTextValue = sourceText.value;
                sourceText.value = translatedText.value;
                translatedText.value = sourceTextValue;
                
                updateCharCount();
                showNotification('Bahasa telah ditukar');
            });
            
            // Process text to make translation more natural
            function naturalizeText(text, sourceLang, targetLang) {
                if (!naturalTranslation.checked) return text;
                
                // Language-specific naturalization rules
                if (targetLang === 'id') {
                    // Indonesian naturalization
                    text = text.replace(/\baku\b/gi, 'saya'); // Formalize first person
                    text = text.replace(/\bengkau\b|\bkau\b/gi, 'kamu'); // Informal second person
                    text = text.replace(/\bmereka itu\b/gi, 'mereka'); // Simplify
                    text = text.replace(/\btersebut\b/gi, 'itu'); // Less formal
                    text = text.replace(/\boleh karena itu\b/gi, 'jadi'); // More natural
                    text = text.replace(/\bapabila\b/gi, 'kalau'); // More conversational
                    text = text.replace(/\bhingga\b/gi, 'sampai'); // More common
                    
                    // Remove excessive formalities for novel mode
                    if (translationMode === 'novel') {
                        text = text.replace(/\b tersebut\b/gi, '');
                        text = text.replace(/\byang telah\b/gi, 'yang');
                        text = text.replace(/\bdengan demikian\b/gi, 'jadi');
                    }
                } else if (targetLang === 'en') {
                    // English naturalization
                    text = text.replace(/\bdo not\b/gi, "don't");
                    text = text.replace(/\bdoes not\b/gi, "doesn't");
                    text = text.replace(/\bdid not\b/gi, "didn't");
                    text = text.replace(/\bis not\b/gi, "isn't");
                    text = text.replace(/\bare not\b/gi, "aren't");
                    text = text.replace(/\bwas not\b/gi, "wasn't");
                    text = text.replace(/\bwere not\b/gi, "weren't");
                    text = text.replace(/\bhave not\b/gi, "haven't");
                    text = text.replace(/\bhas not\b/gi, "hasn't");
                    text = text.replace(/\bhad not\b/gi, "hadn't");
                    text = text.replace(/\bwill not\b/gi, "won't");
                    text = text.replace(/\bwould not\b/gi, "wouldn't");
                    text = text.replace(/\bcannot\b/gi, "can't");
                    text = text.replace(/\bcould not\b/gi, "couldn't");
                    text = text.replace(/\bshall not\b/gi, "shan't");
                    text = text.replace(/\bshould not\b/gi, "shouldn't");
                    text = text.replace(/\bmust not\b/gi, "mustn't");
                }
                
                return text;
            }
            
            // Fix capitalization in text
            function fixTextCapitalization(text) {
                if (!fixCapitalization.checked) return text;
                
                // Split into sentences
                const sentences = text.split(/(?<=[.!?])\s+/);
                let result = '';
                
                for (let sentence of sentences) {
                    if (sentence.length > 0) {
                        // Capitalize first letter of each sentence
                        sentence = sentence.charAt(0).toUpperCase() + sentence.slice(1);
                        result += sentence + ' ';
                    }
                }
                
                return result.trim();
            }
            
            // Capitalize after dots
            function capitalizeAfterDots(text) {
                if (!capitalizeAfterDot.checked) return text;
                
                return text.replace(/([.!?])\s*([a-z])/g, (match, p1, p2) => {
                    return p1 + ' ' + p2.toUpperCase();
                });
            }
            
            // Translate text using Google Translate API
            async function translateText(text, source, target) {
                // Google Translate API endpoint
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${source}&tl=${target}&dt=t&q=${encodeURIComponent(text)}`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error('Terjadi kesalahan saat menerjemahkan');
                    }
                    
                    const data = await response.json();
                    
                    // Extract translated text from response
                    let translated = '';
                    if (data && data[0]) {
                        for (let i = 0; i < data[0].length; i++) {
                            if (data[0][i] && data[0][i][0]) {
                                translated += data[0][i][0];
                            }
                        }
                    }
                    
                    return translated;
                } catch (error) {
                    console.error('Translation error:', error);
                    throw error;
                }
            }
            
            // Handle translation
            translateBtn.addEventListener('click', async function() {
                const text = sourceText.value.trim();
                if (!text) {
                    showNotification('Masukkan teks untuk diterjemahkan', 'error');
                    return;
                }
                
                const source = sourceLang.value;
                const target = targetLang.value;
                
                // Disable button and show progress
                translateBtn.disabled = true;
                progressContainer.style.display = 'block';
                progressBar.value = 0;
                progressStatus.textContent = 'Memulai terjemahan...';
                
                try {
                    // Split long text into chunks to avoid URL length limits
                    const chunkSize = 1500;
                    const chunks = [];
                    
                    for (let i = 0; i < text.length; i += chunkSize) {
                        chunks.push(text.substring(i, i + chunkSize));
                    }
                    
                    let translatedResult = '';
                    
                    for (let i = 0; i < chunks.length; i++) {
                        progressBar.value = (i / chunks.length) * 100;
                        progressStatus.textContent = `Menerjemahkan bagian ${i + 1} dari ${chunks.length}...`;
                        
                        // Translate chunk
                        const translatedChunk = await translateText(chunks[i], source, target);
                        
                        // Apply naturalization and formatting
                        let processedChunk = translatedChunk;
                        processedChunk = naturalizeText(processedChunk, source, target);
                        processedChunk = fixTextCapitalization(processedChunk);
                        processedChunk = capitalizeAfterDots(processedChunk);
                        
                        translatedResult += processedChunk;
                        
                        // Small delay to avoid rate limiting
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }
                    
                    translatedText.value = translatedResult;
                    progressBar.value = 100;
                    progressStatus.textContent = 'Terjemahan selesai!';
                    
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                    }, 1000);
                    
                    showNotification('Teks berhasil diterjemahkan');
                    updateCharCount();
                    
                    // Save to history
                    saveToHistory(text, translatedResult);
                } catch (error) {
                    console.error('Error:', error);
                    progressStatus.textContent = 'Terjadi kesalahan saat menerjemahkan';
                    showNotification('Terjadi kesalahan saat menerjemahkan. Pastikan Anda terhubung ke internet dan coba lagi.', 'error');
                    
                    // Fallback: use simulated translation as backup
                    try {
                        const simulatedTranslation = await simulateTranslation(text, source, target);
                        translatedText.value = simulatedTranslation;
                        showNotification('Menggunakan terjemahan simulasi (hasil mungkin kurang akurat)', 'warning');
                        updateCharCount();
                    } catch (fallbackError) {
                        console.error('Fallback error:', fallbackError);
                    }
                } finally {
                    translateBtn.disabled = false;
                }
            });
            
            // Simulate translation (fallback)
            async function simulateTranslation(text, source, target) {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                let translated = text;
                
                // Apply language-specific transformations to simulate translation
                if (source === 'en' && target === 'id') {
                    translated = translated.replace(/\bthe\b/gi, '');
                    translated = translated.replace(/\ba\b/gi, '');
                    translated = translated.replace(/\ban\b/gi, '');
                    translated = translated.replace(/\bI\b/g, 'Saya');
                    translated = translated.replace(/\byou\b/gi, 'kamu');
                    translated = translated.replace(/\bhe\b/gi, 'dia');
                    translated = translated.replace(/\bshe\b/gi, 'dia');
                    translated = translated.replace(/\bit\b/gi, 'itu');
                    translated = translated.replace(/\bwe\b/gi, 'kita');
                    translated = translated.replace(/\bthey\b/gi, 'mereka');
                    translated = translated.replace(/\bis\b/gi, 'adalah');
                    translated = translated.replace(/\bare\b/gi, 'adalah');
                    translated = translated.replace(/\bwas\b/gi, 'telah');
                    translated = translated.replace(/\bwere\b/gi, 'telah');
                    translated = translated.replace(/\bhello\b/gi, 'halo');
                    translated = translated.replace(/\bgoodbye\b/gi, 'selamat tinggal');
                    translated = translated.replace(/\bthank you\b/gi, 'terima kasih');
                }
                
                // Apply naturalization
                translated = naturalizeText(translated, source, target);
                
                // Fix capitalization
                translated = fixTextCapitalization(translated);
                
                // Capitalize after dots
                translated = capitalizeAfterDots(translated);
                
                return translated;
            }
            
            // Save translation to history
            function saveToHistory(source, translated) {
                const history = JSON.parse(localStorage.getItem('translationHistory')) || [];
                history.unshift({
                    source: source,
                    translated: translated,
                    timestamp: new Date().toISOString()
                });
                
                // Keep only last 10 items
                if (history.length > 10) {
                    history.pop();
                }
                
                localStorage.setItem('translationHistory', JSON.stringify(history));
            }
            
            // Load translation history
            function loadTranslationHistory() {
                const history = JSON.parse(localStorage.getItem('translationHistory')) || [];
                historyList.innerHTML = '';
                
                if (history.length === 0) {
                    historyList.innerHTML = '<div class="history-item">Riwayat terjemahan kosong</div>';
                    return;
                }
                
                history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div class="history-text" title="${item.source}">${item.source.substring(0, 50)}${item.source.length > 50 ? '...' : ''}</div>
                        <div class="history-actions">
                            <button class="history-btn primary" onclick="loadHistoryItem(${index})">Muat</button>
                            <button class="history-btn" onclick="deleteHistoryItem(${index})">Hapus</button>
                        </div>
                    `;
                    historyList.appendChild(historyItem);
                });
            }
            
            // Load history item
            window.loadHistoryItem = function(index) {
                const history = JSON.parse(localStorage.getItem('translationHistory')) || [];
                if (history[index]) {
                    sourceText.value = history[index].source;
                    translatedText.value = history[index].translated;
                    updateCharCount();
                    showNotification('Item riwayat dimuat', 'success');
                }
            };
            
            // Delete history item
            window.deleteHistoryItem = function(index) {
                const history = JSON.parse(localStorage.getItem('translationHistory')) || [];
                history.splice(index, 1);
                localStorage.setItem('translationHistory', JSON.stringify(history));
                loadTranslationHistory();
                showNotification('Item riwayat dihapus', 'success');
            };
            
            // Clear history
            clearHistoryBtn.addEventListener('click', function() {
                if (confirm('Apakah Anda yakin ingin menghapus semua riwayat terjemahan?')) {
                    localStorage.removeItem('translationHistory');
                    loadTranslationHistory();
                    showNotification('Riwayat terjemahan telah dihapus', 'success');
                }
            });
            
            // Save translation session
            saveSessionBtn.addEventListener('click', function() {
                const sessionName = sessionNameInput.value.trim();
                if (!sessionName) {
                    showNotification('Masukkan nama sesi terlebih dahulu', 'error');
                    return;
                }
                
                const sessionData = {
                    name: sessionName,
                    timestamp: new Date().toISOString(),
                    sourceText: sourceText.value,
                    translatedText: translatedText.value,
                    sourceLang: sourceLang.value,
                    targetLang: targetLang.value
                };
                
                const sessions = JSON.parse(localStorage.getItem('translationSessions')) || [];
                sessions.push(sessionData);
                localStorage.setItem('translationSessions', JSON.stringify(sessions));
                
                sessionNameInput.value = '';
                showNotification('Sesi terjemahan disimpan', 'success');
            });
            
            // Clear source text
            clearSourceBtn.addEventListener('click', function() {
                sourceText.value = '';
                updateCharCount();
                showNotification('Teks sumber telah dibersihkan');
            });
            
            // Clear target text
            clearTargetBtn.addEventListener('click', function() {
                translatedText.value = '';
                updateCharCount();
                showNotification('Teks hasil terjemahan telah dibersihkan');
            });
            
            // Import from file
            importFileBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    sourceText.value = e.target.result;
                    updateCharCount();
                    showNotification('File berhasil diimpor');
                };
                
                reader.onerror = function() {
                    showNotification('Gagal membaca file', 'error');
                };
                
                // Handle .txt files
                if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                    reader.readAsText(file);
                } else {
                    showNotification('Hanya file teks (.txt) yang didukung', 'error');
                }
                
                // Reset file input
                fileInput.value = '';
            });
            
            // Export to file
            exportFileBtn.addEventListener('click', function() {
                const text = translatedText.value;
                if (!text) {
                    showNotification('Tidak ada teks untuk diekspor', 'error');
                    return;
                }
                
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'terjemahan-novel.txt';
                a.click();
                
                URL.revokeObjectURL(url);
                showNotification('Teks berhasil diekspor');
            });
            
            // Copy text to clipboard
            copyTextBtn.addEventListener('click', function() {
                if (!translatedText.value) {
                    showNotification('Tidak ada teks untuk disalin', 'error');
                    return;
                }
                
                translatedText.select();
                document.execCommand('copy');
                
                showNotification('Teks berhasil disalin ke clipboard');
            });
            
            // Set translation mode
            modeNovel.addEventListener('click', function() {
                modeNovel.classList.add('active');
                modeFormal.classList.remove('active');
                translationMode = 'novel';
                naturalTranslation.checked = true;
                showNotification('Mode terjemahan novel diaktifkan');
            });
            
            modeFormal.addEventListener('click', function() {
                modeFormal.classList.add('active');
                modeNovel.classList.remove('active');
                translationMode = 'formal';
                naturalTranslation.checked = false;
                showNotification('Mode terjemahan formal diaktifkan');
            });
            
            // Advanced settings toggle
            advancedToggle.addEventListener('click', function() {
                advancedContent.classList.toggle('show');
                const icon = advancedToggle.querySelector('i');
                if (advancedContent.classList.contains('show')) {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                } else {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            });
            
            // Formality slider update
            formalitySlider.addEventListener('input', function() {
                formalityValue.textContent = this.value + '%';
            });
            
            // Preset buttons
            presetCasual.addEventListener('click', function() {
                presetButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                formalitySlider.value = 20;
                formalityValue.textContent = '20%';
            });
            
            presetStandard.addEventListener('click', function() {
                presetButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                formalitySlider.value = 50;
                formalityValue.textContent = '50%';
            });
            
            presetFormal.addEventListener('click', function() {
                presetButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                formalitySlider.value = 80;
                formalityValue.textContent = '80%';
            });
            
            const presetButtons = [presetCasual, presetStandard, presetFormal];
            
            // Toggle history panel
            const historyToggle = document.createElement('button');
            historyToggle.innerHTML = '<i class="fas fa-history"></i> Riwayat';
            historyToggle.className = 'btn btn-warning';
            historyToggle.style.marginTop = '15px';
            historyToggle.addEventListener('click', function() {
                historyPanel.classList.toggle('show');
                if (historyPanel.classList.contains('show')) {
                    loadTranslationHistory();
                }
            });
            
            document.querySelector('.settings-panel').after(historyToggle);
            
            // Update character count on input
            sourceText.addEventListener('input', updateCharCount);
            translatedText.addEventListener('input', updateCharCount);
            
            // Initialize
            populateLanguageDropdowns();
            updateCharCount();
            formalityValue.textContent = formalitySlider.value + '%';
            
            // Add sample text
            sourceText.value = "Hello. my name is John. i am a writer. i like to write novels. this is a sample text for translation. it contains multiple sentences. each sentence starts with a capital letter. after a period, the next sentence should also start with a capital letter.";
            updateCharCount();
        });
    </script>
</body>
</html>
